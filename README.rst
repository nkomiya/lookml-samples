Looker での期間比較のパターン集
###############################

Looker のコミュニティ記事を参考にした、Looker における期間比較のパターン集。

* Reference: https://community.looker.com/technical-tips-tricks-1021/methods-for-period-over-period-pop-analysis-in-looker-30823

パターン一覧
============

| 分析 / 比較期間の指定方法でパターンを分類すると下表の通り。
| #5, 6 を除いて、日付軸は time 型 dimension group の timeframe を使えます。
|

+---+----------------------------------------------+----------------------------------------------------+
| # | カテゴリ (期間指定方法)                      | 補足説明 (カテゴリ内での差分など)                  |
+===+===+==========================================+====================================================+
| 1 | A | | 分析期間: 所定の timeframe [1]         | | Pivot を利用 (LookML での比較ロジックは不要)。   |
|   |   | | 比較期間: 同上                         | | 分析軸を変えるには Explore の操作が必要。        |
+---+   +                                          +----------------------------------------------------+
| 2 |   |                                          | | #1 の軸変更を parameter で行わせる。             |
|   |   |                                          | | (フィルタ操作で完結できる)                       |
+---+---+------------------------------------------+----------------------------------------------------+
| 3 | B | | 分析期間: 任意期間                     | 比較期間は単一期間のみ。                           |
+---+   + | 比較期間: 事前定義した期間 (昨年など)  +----------------------------------------------------+
| 4 |   |                                          | #3 の比較期間数を複数指定できるようにしたもの。    |
+---+---+------------------------------------------+----------------------------------------------------+
| 5 | C | | 分析期間: 任意期間                     | 日付軸は指定不可 (昨対比推移を見れない)            |
+---+   + | 比較期間: 任意期間                     +----------------------------------------------------+
| 6 |   |                                          | #5 に期間内の経過日数の日付軸を追加したもの。      |
+---+---+------------------------------------------+----------------------------------------------------+
| 7 | D | | 分析期間: 任意期間                     | 分析期間と同じ日数で直前にある期間を、             |
|   |   | | 比較期間: 直前期間                     | 比較期間にしたもの。                               |
+---+---+------------------------------------------+----------------------------------------------------+

[1]: timeframe は time 型の dimension group

Explore 一覧
------------

/explores/pop.explore
^^^^^^^^^^^^^^^^^^^^^
| コミュニティ記事のオリジナル版と同じパターン集。
| 期間に重なりがある場合の比較は不可 (数値不整合を生じる)。

/explores/pop_union.explore
^^^^^^^^^^^^^^^^^^^^^^^^^^^^
| オリジナル版における期間重複不可の制限を回避するため、Union を利用したパターン集。
| 指定方法次第で期間の重複が生じ得る、#3 ~ 6 に改修を追加。

|
| 期間の重なりを許容する比較を行うにあたり、Join ではなく Union を採用する理由は、
| 集計軸を任意指定できるようにするため。
| (一般的に Count Distinct は再集計不可のため、Join 前に集計をしたくないケースがある)


補足情報
========

SQL の Dialect
--------------

BigQuery Standard SQL

利用テーブル
------------

BigQuery の public dataset `thelook_ecommerce <https://console.cloud.google.com/bigquery?ws=!1m4!1m3!3m2!1sbigquery-public-data!2sthelook_ecommerce>`_
